<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Mapeo Bridge</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="/assets/js/generateHtml.js"></script>
    <script src="/assets/js/utils.js"></script>
    <script src="/assets/css/tailwind.css"></script>
    <link href="/assets/css/mapbox-gl.css" rel="stylesheet" />
    <script src="/assets/libs/mapbox-gl.js"></script>
    <script src="/assets/libs/axios.min.js"></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="/assets/css/jquery.fancybox.min.css"
    />
    <!-- Load the `mapbox-gl-geocoder` plugin. -->
    <script src="/assets/libs/mapbox-gl-geocoder.min.js"></script>
    <link
      rel="stylesheet"
      href="/assets/css/mapbox-gl-geocoder.css"
      type="text/css"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }

      .mapboxgl-popup {
        min-width: 300px;
      }

      .mapboxgl-popup-content img {
        width: 100%;
      }

      .mapboxgl-popup-close-button {
        top: 5px;
        right: 5px;
        font-size: 40px;
      }

      .mapboxgl-ctrl-top-right {
        top: 60px;
        max-width: 90vw;
      }

      #nav {
        position: absolute;
        top: 0;
        z-index: 99;
        width: 100%;
      }
    </style>
  </head>

  <body>
    <nav id="nav" class="bg-gray-800">
      <div class="mx-auto max-w-7xl px-2 sm:px-6 lg:px-8">
        <div class="relative flex h-16 items-center justify-between">
          <div class="relative items-center justify-between hidden md:flex">
            <h3 class="text-gray-100">Mapeo</h3>
            <a target="_blank" href="https://mapeo.app"
              ><img style="height: 35px" src="/assets/imgs/mapeo.png"
            /></a>
          </div>
        </div>
      </div>
    </nav>
    <div id="map"></div>
    <script>
      mapboxgl.accessToken =
        "pk.eyJ1IjoiZGQtbWFwZW8iLCJhIjoiY2tuaGtxN2hjMjg5YTJ1b29kb3k4a3hwMCJ9.Q4cR8vp-Z6pP9PTUswy7Vw";
      const storage = window.localStorage;
      let addLoading;
      const storedCenter = storage.getItem("map_center");
      const center = storedCenter && JSON.parse(storedCenter);
      const map = new mapboxgl.Map({
        container: "map",
        zoom: 5,
        center: center || [0, 0],
        style: "mapbox://styles/dd-mapeo/cl143pibo001315nwckxwxn7f",
      });
      map.addControl(
        new MapboxGeocoder({
          accessToken: mapboxgl.accessToken,
          mapboxgl: mapboxgl,
        })
      );
      map.addControl(
        new mapboxgl.GeolocateControl({
          positionOptions: {
            enableHighAccuracy: true,
          },
          // When active the map will receive updates to the device's location as it changes.
          trackUserLocation: true,
          // Draw an arrow next to the location dot to indicate which direction the device is heading.
          showUserHeading: true,
        })
      );
      window.mapboxMap = map;
      // Map
      map.on("load", async () => {
        // Network
        try {
          await observationsToMarkers({ map, filter: true });
        } catch (err) {
          console.log("Error", err);
        }
      });
    </script>
    Loading...
  </body>
</html>
